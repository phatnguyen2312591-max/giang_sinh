<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√≥n Qu√† Gi√°ng Sinh C·ªßa Quy√™n</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0; padding: 0;
            background: #051937;
            background-image: radial-gradient(circle, #a80000, #540000, #2b0000);
            color: white;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        /* --- PH·∫¶N 1: H·ªòP QU√Ä --- */
        #gift-screen {
            cursor: pointer;
            z-index: 99999; /* ∆Øu ti√™n cao nh·∫•t ƒë·ªÉ click ƒë∆∞·ª£c */
            position: relative; /* B·∫Øt bu·ªôc c√≥ ƒë·ªÉ nh·∫≠n z-index */
            transition: all 0.3s;
            padding: 50px; /* TƒÉng v√πng b·∫•m */
        }
        
        .gift-box {
            font-size: 150px;
            animation: shake 2s infinite; 
            display: inline-block;
            transition: all 0.5s;
            transform-origin: bottom center;
            user-select: none;
        }

        .gift-exploding {
            animation: violent-explode 1s forwards ease-in !important;
            pointer-events: none;
        }

        .click-hint {
            margin-top: 20px;
            font-size: 1.2rem;
            color: #fff;
            animation: blink 1.5s infinite;
        }

        /* --- PH·∫¶N 2: L·ªúI CH√öC --- */
        #celebration-screen {
            display: none;
            opacity: 0; 
            transition: opacity 3s ease-in;
            text-align: center;
            width: 90%;
            max-width: 600px;
            z-index: 50;
            position: relative;
        }

        .main-photo-highlight {
            width: 300px;
            border-radius: 20px;
            border: 4px solid #ffd700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.5);
            animation: pulse-glow 3s infinite alternate ease-in-out;
            position: relative;
            z-index: 60;
            max-width: 80vw;
        }

        h1 {
            font-family: 'Dancing Script', cursive;
            font-weight: 700;
            font-size: 3.5rem;
            color: #fffce0;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.2);
            margin-bottom: 5px;
        }

        /* --- CODE CH·ªÆ CH·∫†Y (TYPEWRITER) --- */
        #loi-chuc {
              font-family: 'Dancing Script', cursive;
              font-size: 28px;
              color: #fff;
              line-height: 1.5;
              white-space: pre-wrap; 
              overflow: hidden;
              border-right: 3px solid white; /* Con tr·ªè nh·∫•p nh√°y */
              padding-right: 5px;
              animation: blink-caret 0.75s step-end infinite;
              display: inline-block;
              max-width: 80%;
        }

        @keyframes blink-caret {
              from, to { border-color: transparent }
              50% { border-color: white; }
        }

        /* --- ANIMATION --- */
        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-5deg); }
        }

        @keyframes violent-explode {
            0% { transform: scale(1) rotate(0deg); filter: hue-rotate(0deg); }
            50% { transform: scale(1.6) rotate(-10deg); filter: hue-rotate(180deg); opacity: 0.8; }
            100% { transform: scale(3); opacity: 0; }
        }

        @keyframes blink { 
            0%, 100% { opacity: 1; } 
            50% { opacity: 0.5; } 
        }
        
        @keyframes pulse-glow {
            0% { transform: scale(1); box-shadow: 0 0 40px rgba(255, 215, 0, 0.5); }
            100% { transform: scale(1.05); box-shadow: 0 0 60px rgba(255, 165, 0, 0.7); border-color: #ffa500; }
        }

        .wobble { animation: wobble 2s infinite ease-in-out; display: inline-block; }
        @keyframes wobble { 
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        .icons-row { font-size: 3rem; margin-top: 10px; display: flex; justify-content: center; gap: 10px; }
        
        .snowflake { 
            position: fixed; top: -10px; color: white; 
            user-select: none; pointer-events: none;
            animation-name: fall; animation-timing-function: linear; z-index: 1;
        }
        @keyframes fall { to { transform: translateY(105vh); } }
      
        .decor-img { position: absolute; z-index: 40; }

        /* --- XE TU·∫¶N L·ªòC (ƒê√£ Fix Click) --- */
        #santa-sleigh-container {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            pointer-events: none !important; /* QUAN TR·ªåNG: Cho ph√©p click xuy√™n qua */
            z-index: 200;
            display: none;
        }

        .santa-img {
            width: 300px;
            position: absolute;
            will-change: transform; 
        }

        @keyframes santa-cinematic-fly {
            0% { transform: translate3d(-120vw, -20vh, 0) scale(0.5) rotate(-10deg); opacity: 0; }
            40% { opacity: 1; transform: translate3d(calc(50vw - 150px), 45vh, 0) scale(1.5) rotate(0deg); }
            100% { transform: translate3d(120vw, -40vh, 0) scale(0.6) rotate(10deg); opacity: 0.8; }
        }

        .santa-flying-active { display: block !important; }
        
        .santa-flying-active .santa-img {
            animation: santa-cinematic-fly 7s cubic-bezier(0.25, 1, 0.5, 1) forwards;
        } 
    </style>
</head>
<body>

    <div id="gift-screen" onclick="openGift()">
        <div class="gift-box">üéÅ</div> 
        <div class="click-hint">Quy√™n ∆°i m·ªü qu√† ƒëi n√†o!</div>
    </div>

    <div id="celebration-screen">
        <img src="vat1.png" class="decor-img wobble" style="top: 15%; left: 4%; width: 80px;" alt="Decor">
        <img src="vat2.png" class="decor-img wobble" style="top: 12%; right: 5%; width: 100px;" alt="Decor">
        <img src="vat3.png" class="decor-img wobble" style="top: 60%; left: 95%; width: 80px;" alt="Decor">
        <img src="vat4.png" class="decor-img wobble" style="top: 55%; right: 97%; width: 120px;" alt="Decor">
        
        <img src="noel.jpg" class="main-photo-highlight" alt="·∫¢nh Gi√°ng Sinh">
        
        <h1>üéÑ Merry Christmas üéÑ</h1>
        
        <div class="container" style="min-height: 80px;"> <div style="text-align: center;"> 
                <p id="loi-chuc"></p>
            </div>
        </div>
        
        <div class="icons-row">
            <div class="icon-item wobble">üéÖ</div>
            <div class="icon-item wobble">‚õÑ</div>
            <div class="icon-item wobble">ü¶å</div>
            <div class="icon-item wobble">üîî</div>
        </div>
    </div>

    <div id="santa-sleigh-container">
        <img src="santa.png" class="santa-img" alt="Santa Claus">
    </div>

    <audio id="bgMusic" loop> <source src="nhac.mp3" type="audio/mpeg"> </audio>
    <audio id="sleighBellSound"> <source src="chuong.mp3" type="audio/mpeg"> </audio>
    <audio id="explosionSound"> <source src="phaohoa.mp3" type="audio/mpeg"> </audio>

    <script>
        // --- 1. C·∫§U H√åNH BI·∫æN (Ch·ªâ khai b√°o 1 l·∫ßn ·ªü ƒë√¢y) ---
        const textConfig = "Ch√∫c Quy√™n m·ªôt m√πa Gi√°ng sinh ·∫•m √°p, h·∫°nh ph√∫c v√† tr√†n ƒë·∫ßy ni·ªÅm vui! ‚ú®‚ú®";
        const speedConfig = 100; // T·ªëc ƒë·ªô ch·∫°y ch·ªØ
        let textIndex = 0;

        // --- 2. H√ÄM CH·∫†Y CH·ªÆ ---
        function typeWriter() {
            const element = document.getElementById("loi-chuc");
            if (!element) return;

            if (textIndex < textConfig.length) {
                element.innerHTML += textConfig.charAt(textIndex);
                textIndex++;
                setTimeout(typeWriter, speedConfig);
            } else {
                element.style.borderRight = "none"; // X√≥a con tr·ªè khi xong
            }
        }

        // --- 3. H√ÄM M·ªû QU√Ä ---
        function openGift() {
            console.log("ƒê√£ click m·ªü qu√†!");

            // ·∫®n g·ª£i √Ω
            var hint = document.querySelector('.click-hint');
            if (hint) hint.style.display = 'none';
            
            // Hi·ªáu ·ª©ng n·ªï h·ªôp qu√†
            var giftBox = document.querySelector('.gift-box');
            if (giftBox) giftBox.classList.add('gift-exploding');

            // B·∫Øn ph√°o gi·∫•y (Try-catch ƒë·ªÉ tr√°nh l·ªói th∆∞ vi·ªán l√†m ch·∫øt web)
            try {
                confetti({ particleCount: 50, spread: 100, origin: { y: 0.5 }, colors: ['#ff0000', '#ffa500'], startVelocity: 30 });
            } catch (e) { console.log("L·ªói confetti:", e); }

            // --- CHU·ªñI S·ª∞ KI·ªÜN SAU 0.8 GI√ÇY ---
            setTimeout(function() {
                // a. ·∫®n m√†n h√¨nh qu√†
                document.getElementById('gift-screen').style.display = 'none';

                // b. √Çm thanh
                var explosion = document.getElementById('explosionSound');
                if (explosion) { explosion.volume = 1.0; explosion.currentTime = 0; explosion.play().catch(e => {}); }
                
                var music = document.getElementById('bgMusic');
                if (music) { music.volume = 0.7; music.play().catch(e => {}); }

                // c. Xe Santa Bay
                var santaContainer = document.getElementById('santa-sleigh-container');
                var bellSound = document.getElementById('sleighBellSound');
                
                if (santaContainer) {
                    santaContainer.style.display = 'block';
                    santaContainer.classList.add('santa-flying-active');
                    
                    if (bellSound) { 
                        bellSound.volume = 0.8; bellSound.currentTime = 0; bellSound.play().catch(e => {}); 
                    }
                    
                    // ·∫®n xe sau 8s
                    setTimeout(() => { santaContainer.style.display = 'none'; }, 8000);
                }

                // d. Hi·ªáu ·ª©ng n·ªÅn
                try { fireworks(); } catch(e) {}
                setInterval(createSnowflake, 200);

                // --- GIAI ƒêO·∫†N 2: HI·ªÜN L·ªúI CH√öC (Sau 4s ch·ªù xe bay) ---
                setTimeout(function() {
                    var celebration = document.getElementById('celebration-screen');
                    if (celebration) {
                        celebration.style.display = 'block'; 
                        setTimeout(() => { celebration.style.opacity = 1; }, 50);
                        
                        // QUAN TR·ªåNG: G·ªçi h√†m ch·∫°y ch·ªØ ·ªü ƒë√¢y
                        setTimeout(typeWriter, 1000); 
                    }
                }, 4000); 

            }, 800);
        }

        // --- C√ÅC H√ÄM PH·ª§ TR·ª¢ ---
        function fireworks() {
            var duration = 4 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                var particleCount = 50 * (timeLeft / duration);
                try {
                    confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random(), y: Math.random() - 0.2 } }));
                } catch(e) { clearInterval(interval); }
            }, 250);
        }

        function createSnowflake() {
            const snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');
            snowflake.innerHTML = '‚ùÑ';
            snowflake.style.left = Math.random() * 100 + 'vw';
            snowflake.style.animationDuration = Math.random() * 3 + 2 + 's';
            snowflake.style.opacity = Math.random();
            snowflake.style.fontSize = Math.random() * 20 + 20 + 'px';
            document.body.appendChild(snowflake);
            setTimeout(() => { snowflake.remove(); }, 5000);
        }
    </script>
</body>
</html>
